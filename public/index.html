<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TARBOO API Hub</title>
    <!-- TailwindCSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />
    <!-- GSAP for Animation -->
    <script src="https://unpkg.com/gsap@3.12.2/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>
    <link rel="icon" href="https://i.ibb.co/0jQ3ZzG/logo.png">
    <meta name="theme-color" content="#6d28d9" />
    <meta name="description" content="Ù…Ù†ØµØ© TARBOO: Ø£ÙØ¶Ù„ Ù…ÙƒØ§Ù† Ù„Ø§ÙƒØªØ´Ø§Ù ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¬Ù‡Ø§Øª API Ø¹Ø±Ø¨ÙŠØ© Ù…ØªØ·ÙˆØ±Ø©">
    <style>
        body { font-family: 'Tajawal', 'Cairo', sans-serif; background: #101827; color: #fff; }
        .particles-bg { position: fixed; inset: 0; z-index: -2; pointer-events: none;}
        .gradient-text { background: linear-gradient(90deg, #6d28d9 20%, #ec4899 55%, #f59e0b 90%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent;}
        /* Splash */
        .splash-screen { position: fixed; inset: 0; background: #101827; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50; }
        .splash-logo { width: 130px; height: 130px; border-radius: 50%; background: linear-gradient(145deg, #6d28d9, #ec4899, #f59e0b); display: flex; align-items: center; justify-content: center; margin-bottom: 20px; box-shadow: 0 0 30px #6d28d9cc; }
        .splash-logo img { width: 82px; height: 82px; border-radius: 50%; border: 3px solid #fff3; }
        .progress-bar { width: 70%; height: 10px; background: #262a41; border-radius: 10px; overflow: hidden; margin: 20px auto; }
        .progress-fill { height: 100%; width: 0; background: linear-gradient(90deg, #ec4899, #f59e0b); border-radius: 10px; transition: width 0.4s;}
        .fade-out { animation: fadeOutSplash 1s ease forwards; }
        @keyframes fadeOutSplash { to { opacity: 0; visibility: hidden; } }
        /* Particles Animation */
        @keyframes floatUp {
            0% {transform: translateY(0);}
            100% {transform: translateY(-100vh);}
        }
        /* Ripple Effect */
        .ripple { position: absolute; border-radius: 50%; transform: scale(0); animation: ripple-effect 0.5s linear; background: rgba(236, 72, 153, 0.4);}
        @keyframes ripple-effect {
          to { transform: scale(2.5); opacity: 0;}
        }
        /* Tooltip */
        .tooltip { pointer-events: none; position: absolute; top: -40px; right: 50%; transform: translateX(50%); background: #23263b; color: #fff; padding: 4px 16px; border-radius: 8px; font-size: 0.85rem; opacity: 0; transition: opacity 0.25s;}
        .api-type-btn:hover .tooltip { opacity: 1;}
        /* Badges */
        .badge { font-size: 0.8rem; padding: 2px 10px; border-radius: 9999px; color: #fff; background: linear-gradient(90deg, #ec4899, #f59e0b);}
        /* Glow titles */
        .glow-title { text-shadow: 0 0 20px #ec4899, 0 0 40px #6d28d9;}
        /* Progress Bar (Scroll) */
        #scroll-progress { position: fixed; top: 0; left: 0; height: 4px; width: 0; background: linear-gradient(90deg,#6d28d9,#ec4899,#f59e0b); z-index: 100;}
        /* Glass effect */
        .glass { background: rgba(30,41,59,0.4); backdrop-filter: blur(12px);}
        /* Light mode */
        body.light { background: #f8fafc; color: #23263b; }
        body.light .glass { background: rgba(255,255,255,0.5); }
        body.light .gradient-text, body.light .badge { background: linear-gradient(90deg, #6d28d9 20%, #ec4899 55%, #f59e0b 90%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent;}
    </style>
</head>
<body>
    <div id="scroll-progress"></div>
    <!-- Splash Screen -->
    <div id="splash" class="splash-screen">
        <div class="splash-logo animate-pulse">
            <img src="https://i.ibb.co/0jQ3ZzG/logo.png" alt="TARBOO Logo" />
        </div>
        <h1 class="text-3xl md:text-4xl font-bold mb-4 glow-title gradient-text">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ TARBOO API ğŸš€</h1>
        <div class="progress-bar"><div id="progress" class="progress-fill"></div></div>
        <button onclick="enterSite()" class="btn-primary mt-4 px-8 py-3 font-bold rounded-full gradient-text shadow-lg" aria-label="Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹"><span>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span></button>
    </div>

    <!-- Particles -->
    <div id="particles-bg" class="particles-bg"></div>
    <!-- Ø®Ù„ÙÙŠØ© ÙÙŠØ¯ÙŠÙˆ (ØµØ§Ù…ØªØ©) -->
    <video class="fixed top-0 left-0 w-full h-full object-cover z-[-3]" autoplay loop muted>
        <source src="https://files.catbox.moe/5etht6.mp4" type="video/webm" />
    </video>
    <!-- Overlay -->
    <div class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-60 z-[-2]"></div>

    <!-- Header -->
    <header class="fixed top-0 w-full flex justify-between items-center px-6 py-3 glass z-30 shadow-lg">
        <div class="flex items-center gap-2 relative">
            <span class="text-xl font-extrabold gradient-text" id="main-title">TARBOO</span>
            <span class="absolute -top-3 left-0 badge animate-bounce" style="font-size:0.7rem;">Ø¬Ø¯ÙŠØ¯</span>
        </div>
        <nav class="space-x-4 space-x-reverse hidden md:flex">
            <a href="#services" class="hover:underline">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
            <a href="#features" class="hover:underline">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª</a>
            <a href="#contact" class="hover:underline">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
        </nav>
        <div class="flex items-center gap-2">
            <button id="theme-toggle" onclick="toggleTheme()" class="btn-send text-sm" aria-label="ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…">ÙˆØ¶Ø¹ Ù†Ù‡Ø§Ø±ÙŠ</button>
        </div>
    </header>

    <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ£Ù†ÙˆØ§Ø¹ APIs -->
    <main class="flex flex-col items-center px-4 py-28 min-h-screen">
        <div class="flex gap-2 mb-6 w-full max-w-md">
            <input id="search" type="text" oninput="filterTypes()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù†ÙˆØ¹ API..." class="flex-1 p-3 rounded-lg text-black focus:ring-2 focus:ring-pink-400 focus:outline-none shadow" />
        </div>
        <p id="message" class="text-gray-300 mb-6 text-lg">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        <div id="type-container" class="grid grid-cols-1 md:grid-cols-2 gap-7 max-w-3xl w-full"></div>
    </main>

    <!-- Chatbot -->
    <div class="fixed bottom-6 right-6 z-50">
        <div class="chatbot-icon cursor-pointer" onclick="toggleChat()" aria-label="Ù…Ø³Ø§Ø¹Ø¯ TARBOO" tabindex="0">
            <img src="https://c.top4top.io/p_3352185ep0.jpg" alt="Bot" class="rounded-full w-14 h-14 shadow-lg border-2 border-pink-500 hover:scale-110 transition"/>
        </div>
        <div id="chat-container" class="hidden mt-2 w-80 p-4 glass rounded-2xl shadow-lg">
            <div class="flex justify-between items-center text-white mb-3">
                <span class="font-bold text-lg">ğŸ’¬ TARBOO Bot</span>
                <button onclick="toggleChat()" class="btn-close" aria-label="Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø§Øª">Ã—</button>
            </div>
            <div id="chat-messages" class="h-64 overflow-y-auto space-y-2 mb-2 text-right text-sm"></div>
            <div class="flex gap-2">
                <input id="chat-input" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="handleKeyPress(event)" class="flex-1 p-2 rounded text-black focus:ring-2 focus:ring-pink-400 focus:outline-none" aria-label="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ" />
                <button onclick="sendMessage()" class="btn-send" aria-label="Ø¥Ø±Ø³Ø§Ù„"><span>Ø¥Ø±Ø³Ø§Ù„</span></button>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip hidden"></div>

    <!-- Script -->
    <script>
    // ========== SPLASH + PARTICLES ========== //
    function createParticles() {
        const bg = document.getElementById("particles-bg");
        for (let i = 0; i < 36; i++) {
            const p = document.createElement("div");
            const size = Math.random() * 15 + 10;
            p.style.position = "absolute";
            p.style.width = p.style.height = size + "px";
            p.style.borderRadius = "50%";
            p.style.background = `rgba(${120+Math.random()*80},${40+Math.random()*60},${210+Math.random()*40},${Math.random()*0.3+0.08})`;
            p.style.left = Math.random()*100+"vw";
            p.style.top = Math.random()*100+"vh";
            p.style.filter = "blur(2px)";
            p.style.animation = `floatUp ${12+Math.random()*16}s linear infinite`;
            bg.appendChild(p);
        }
    }
    document.addEventListener("DOMContentLoaded", createParticles);

    function simulateLoading() {
        const bar = document.getElementById("progress");
        let p = 0;
        const int = setInterval(() => {
            p += 2.2;
            if (bar) bar.style.width = p + "%";
            if (p >= 100) clearInterval(int);
        }, 38);
    }
    simulateLoading();

    function enterSite() {
        const splash = document.getElementById("splash");
        gsap.to(splash, {
            opacity: 0, duration: 1, ease: "power2.out",
            onComplete: () => { splash.style.display = "none"; animatePageIn(); }
        });
        // ØµÙˆØª Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        // new Audio('assets/success.mp3').play();
    }

    // ========== HEADER PARALLAX ========== //
    window.addEventListener("scroll", () => {
        const h = document.querySelector("header");
        h.style.backdropFilter = `blur(${6 + Math.min(window.scrollY/80,10)}px)`;
        h.style.background = `rgba(16,24,39,${0.25 + Math.min(window.scrollY/320,0.18)})`;
    });

    // ========== SCROLL PROGRESS BAR ========== //
    function initProgressBar() {
        window.addEventListener("scroll", () => {
            const s = document.documentElement.scrollTop, d = document.documentElement.scrollHeight - window.innerHeight;
            const p = (s/d)*100;
            document.getElementById("scroll-progress").style.width = p + "%";
        });
    }
    initProgressBar();

    // ========== THEME TOGGLE ========== //
    function toggleTheme() {
        const body = document.body;
        body.classList.toggle("light");
        localStorage.setItem("theme", body.classList.contains("light") ? "light" : "dark");
        document.getElementById("theme-toggle").textContent = body.classList.contains("light") ? "ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ" : "ÙˆØ¶Ø¹ Ù†Ù‡Ø§Ø±ÙŠ";
    }
    // Auto-load theme
    window.onload = function() {
        if(localStorage.getItem("theme") === "light") document.body.classList.add("light");
        document.getElementById("theme-toggle").textContent = document.body.classList.contains("light") ? "ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ" : "ÙˆØ¶Ø¹ Ù†Ù‡Ø§Ø±ÙŠ";
    };

    // ========== API TYPES LOADING, FILTERING, INTERACTIONS ========== //
    let allTypes = [], allAPIs = [];
    async function loadTypes() {
        try {
            const res = await fetch("/api/list");
            const data = await res.json();
            allAPIs = data;
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
            const typeCounts = {};
            const recentTypes = {};
            const now = Date.now();
            data.forEach(api => {
                let t = api.type || "Ø§ÙØªØ±Ø§Ø¶ÙŠ";
                typeCounts[t] = (typeCounts[t] || 0) + 1;
                // Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ø®Ù„Ø§Ù„ 14 ÙŠÙˆÙ…
                if (api.created_at && (now - new Date(api.created_at).getTime())/86400000 < 14) recentTypes[t] = true;
            });
            allTypes = Object.keys(typeCounts).map(type => ({
                name: type,
                count: typeCounts[type],
                recent: !!recentTypes[type],
                icon: pickTypeIcon(type)
            }));
            renderTypes(allTypes);
        } catch (err) {
            document.getElementById("message").innerText = "âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
        }
    }

    function pickTypeIcon(type) {
        // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù€API (Ø¹Ø¯Ù„/Ø£Ø¶Ù Ø­Ø³Ø¨ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹)
        const icons = {
            "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": "fa-brain",
            "Ø­Ù…Ø§ÙŠØ©": "fa-lock",
            "Ø¯ÙØ¹": "fa-money-bill-wave",
            "ØµÙˆØ±Ø©": "fa-image",
            "Ù†Øµ": "fa-file-alt",
            "Ø£Ø®Ø¨Ø§Ø±": "fa-newspaper",
            "ØµÙˆØª": "fa-volume-up",
            "ØªØ­ÙˆÙŠÙ„": "fa-sync",
            "ØªØ±Ø¬Ù…Ø©": "fa-language",
            "Ø§ÙØªØ±Ø§Ø¶ÙŠ": "fa-cubes"
        };
        return icons[type] || "fa-cubes";
    }

    function renderTypes(list) {
        const container = document.getElementById("type-container");
        container.innerHTML = "";
        list.forEach(type => {
            const el = document.createElement("a");
            el.className = "api-type-btn glass shadow-xl relative flex flex-col items-center justify-center py-7 px-4 rounded-2xl transition transform hover:scale-105 focus:scale-105 duration-300 group";
            el.href = `type.html?type=${encodeURIComponent(type.name)}`;
            el.setAttribute("tabindex","0");
            el.setAttribute("aria-label",type.name);
            el.innerHTML = `
                <span class="tooltip hidden">Ø¥Ø¶ØºØ· Ù„Ø§ÙƒØªØ´Ø§Ù ${type.name} APIs</span>
                <i class="fa-solid ${type.icon} text-3xl mb-2"></i>
                <span class="font-bold text-lg gradient-text mb-1">${type.name}</span>
                <span class="text-xs text-pink-300 mb-2">${type.count} ÙˆØ§Ø¬Ù‡Ø©</span>
                ${type.recent ? `<span class="badge absolute top-3 left-3 animate-pulse">Ø¬Ø¯ÙŠØ¯</span>` : ""}
            `;
            // Tooltip
            el.addEventListener("mouseenter", function(e){
                const tt = el.querySelector(".tooltip");
                tt.classList.remove("hidden");
            });
            el.addEventListener("mouseleave", function(e){
                const tt = el.querySelector(".tooltip");
                tt.classList.add("hidden");
            });
            // Ripple
            el.addEventListener("click", function(e){
                const ripple = document.createElement("span");
                ripple.className = "ripple";
                ripple.style.right = (e.offsetX)+"px";
                ripple.style.top = (e.offsetY)+"px";
                el.appendChild(ripple);
                setTimeout(()=>{ripple.remove();},600);
            });
            container.appendChild(el);
        });
        // GSAP stagger in
        gsap.from(".api-type-btn", { opacity: 0, y: 50, stagger: 0.09, duration: 0.6, ease: "power2.out" });
    }

    function filterTypes() {
        const q = document.getElementById("search").value.toLowerCase();
        const filtered = allTypes.filter(t => t.name.toLowerCase().includes(q));
        renderTypes(filtered);
    }

    // ========== CHATBOT ========== //
    function toggleChat() {
        const chat = document.getElementById("chat-container");
        chat.classList.toggle("hidden");
        if (!chat.classList.contains("hidden")) {
            gsap.fromTo(chat, { y: 40, opacity: 0 }, { y: 0, opacity: 1, duration: 0.4, ease: "power2.out" });
        }
    }
    function handleKeyPress(e) {
        if (e.key === "Enter") sendMessage();
    }
    async function sendMessage() {
        const input = document.getElementById("chat-input");
        const messages = document.getElementById("chat-messages");
        const msg = input.value.trim();
        const prompt = "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ø§Ø³Ù…Ù‡ TARBOO. Ù‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ù‡Ø°Ø¨Ø© ÙˆØ¨Ø£Ø³Ù„ÙˆØ¨ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ.";
        if (!msg) return;
        messages.innerHTML += `<div class='user-msg text-right bg-blue-700 px-4 py-2 rounded-xl shadow-md ml-12 mb-1'><span>${msg}</span></div>`;
        input.value = "";
        messages.scrollTop = messages.scrollHeight;
        // Typing indicator
        const typing = document.createElement("div");
        typing.className = "bot-msg bg-gray-800 px-4 py-2 rounded-xl shadow-md mr-12 mb-1";
        typing.innerHTML = `<span><i class="fa fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø§Ù„ØªÙÙƒÙŠØ±...</span>`;
        messages.appendChild(typing);
        messages.scrollTop = messages.scrollHeight;
        try {
            const res = await fetch(`/api/ai/cai?prompt=${prompt}&text=${encodeURIComponent(msg)}`);
            const reply = await res.text();
            typing.remove();
            messages.innerHTML += `<div class='bot-msg bg-gray-800 px-4 py-2 rounded-xl shadow-md mr-12 mb-1'><span>${reply}</span>
                <button onclick="rateBot('like',this)" title="Ù…ÙÙŠØ¯" class="ml-2 text-green-400"><i class="fa fa-thumbs-up"></i></button>
                <button onclick="rateBot('dislike',this)" title="ØºÙŠØ± Ù…ÙÙŠØ¯" class="text-red-400"><i class="fa fa-thumbs-down"></i></button>
            </div>`;
            messages.scrollTop = messages.scrollHeight;
        } catch {
            typing.remove();
            messages.innerHTML += `<div class='error-msg bg-red-700 px-4 py-2 rounded-xl shadow-md mr-12 mb-1'><span>âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</span></div>`;
        }
    }
    function rateBot(type,btn) {
        btn.parentElement.innerHTML += `<span class="ml-2 text-sm ${type=='like'?'text-green-300':'text-red-300'}">${type=='like'?'Ø´ÙƒØ±Ø§Ù‹!':'Ø³Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø³ÙŠÙ†'}</span>`;
        btn.parentElement.querySelectorAll('button').forEach(b=>b.remove());
    }

    function animatePageIn() {
        gsap.from("#main-title", { y: -40, opacity: 0, duration: 1, ease: "power3.out" });
        gsap.from("main", { opacity: 0, y: 20, duration: 1, delay: 0.3, ease: "power3.out" });
        gsap.from(".chatbot-icon", { scale: 0, opacity: 0, duration: 0.7, delay: 0.7, ease: "back.out(1.7)" });
    }

    // ========== INIT ========== //
    loadTypes();
    </script>
</body>
</html>
